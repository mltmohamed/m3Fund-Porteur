<div class="fonds-container">
  <!-- Carte récapitulatif -->
  <div class="summary-cards">
    <div class="summary-card">
      <div class="card-icon">
        <i class="fas fa-wallet"></i>
      </div>
      <div class="card-content">
        <div class="card-value">{{ totalFundDisplay || '0 FCFA' }}</div>
        <div class="card-title">Total encaissé</div>
      </div>
    </div>
  </div>


  <!-- Barre de recherche et filtres -->
  <div class="search-filters">
    <div class="search-bar">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        placeholder="Rechercher des transactions ..." 
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
      >
    </div>
    <div class="filters">
      <select [(ngModel)]="selectedStatus" (change)="onStatusChange()">
        <option *ngFor="let option of statusOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
      <select [(ngModel)]="selectedPeriod" (change)="onPeriodChange()">
        <option *ngFor="let option of periodOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
      <select [(ngModel)]="selectedSourceType" (change)="onSourceTypeChange()">
        <option *ngFor="let option of sourceTypeOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
  </div>




  <!-- Indicateur de chargement -->
  <div class="loading-container" *ngIf="loading">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Chargement des transactions...</p>
    </div>
  </div>

  <!-- Message d'erreur -->
  <div class="error-container" *ngIf="error && !loading">
    <div class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadTransactions()">
        <i class="fas fa-redo"></i>
        Réessayer
      </button>
    </div>
  </div>

  <!-- Message quand aucune transaction -->
  <div class="no-transactions" *ngIf="!loading && !error && filteredTransactions.length === 0">
    <i class="fas fa-receipt"></i>
    <p>Aucune transaction trouvée</p>
  </div>

  <!-- Liste des transactions -->
  <div class="transactions-container" *ngIf="!loading && filteredTransactions.length > 0">
    <div class="transaction-item" *ngFor="let transaction of filteredTransactions">
      <div class="transaction-content">
        <!-- Avatar avec initiales pour les contributions -->
        <div class="transaction-avatar" *ngIf="transaction.contributorInitials">
          <div class="avatar-circle">
            {{ transaction.contributorInitials }}
          </div>
        </div>
        
        <!-- Icône pour les décaissements admin -->
        <div class="transaction-avatar" *ngIf="!transaction.contributorInitials">
          <div class="avatar-icon">
            <i class="fas fa-university"></i>
          </div>
        </div>
        
        <div class="payment-method">
          <span class="method-text">{{ transaction.paymentMethod }}</span>
        </div>
        
        <div class="project-info">
          <span class="project-name">{{ transaction.project }}</span>
        </div>
        
        <div class="amount-display">
          <span class="amount-value">{{ transaction.amount }}</span>
        </div>
        
        <div class="transaction-actions">
          <button class="info-btn" (click)="openTransactionModal(transaction)">
            <i class="fas fa-info"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de détail de transaction -->
  <div class="modal-overlay" *ngIf="showTransactionModal" (click)="closeTransactionModal()">
    <div class="transaction-modal-content" (click)="$event.stopPropagation()" *ngIf="selectedTransaction">
      <!-- En-tête du modal -->
      <div class="transaction-modal-header">
        <button class="close-btn" (click)="closeTransactionModal()">
          <i class="fas fa-times"></i>
        </button>
        <h2 class="transaction-modal-title">{{ selectedTransaction.project.split(' ').slice(0, -1).join(' ') }}</h2>
        <div class="transaction-modal-category" [class]="(selectedTransaction.projectDomain || 'sante').toLowerCase()">
          {{ selectedTransaction.projectDomain || 'SANTE' }}
        </div>
      </div>

      <!-- Contenu du modal -->
      <div class="transaction-modal-body">
        <div class="transaction-modal-row">
          <div class="transaction-modal-label">Date</div>
          <div class="transaction-modal-value">{{ selectedTransaction.transactionDate }}</div>
        </div>
        
        <div class="transaction-modal-row">
          <div class="transaction-modal-label">Statut</div>
          <div class="transaction-modal-value">{{ selectedTransaction.transactionStatus }}</div>
        </div>
        
        <div class="transaction-modal-row">
          <div class="transaction-modal-label">Moyen de paiement</div>
          <div class="transaction-modal-value">{{ selectedTransaction.paymentMethodDetail }}</div>
        </div>
        
        <div class="transaction-modal-row">
          <div class="transaction-modal-label">Numéro du destinateur</div>
          <div class="transaction-modal-value">{{ selectedTransaction.recipientNumber }}</div>
        </div>
        
        <div class="transaction-modal-row">
          <div class="transaction-modal-label">Raison de la transaction</div>
          <div class="transaction-modal-value">{{ selectedTransaction.transactionReason }}</div>
        </div>
      </div>

      <!-- Bouton de téléchargement -->
      <div class="transaction-modal-footer">
        <button class="download-btn" (click)="downloadReport()">
          <i class="fas fa-download"></i>
          Télécharger le rapport
        </button>
      </div>
    </div>
  </div>
</div>
