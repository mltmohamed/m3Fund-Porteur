<section class="projects-section">
  <div class="section-header">
    <h2>Mes Projets actifs</h2>
    <div class="header-actions">
      <button *ngIf="projectStats" class="stats-btn" [style.color]="projectStats.color">
        <i [class]="projectStats.icon"></i>
        {{ projectStats.value }} projets
      </button>
      <button class="see-all-btn" (click)="goToProjects()">Voir Tout ></button>
    </div>
  </div>

  <!-- État de chargement -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Chargement des projets...</p>
    </div>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage && !isLoading" class="error-message">
    <div class="error-content">
      <span>{{ errorMessage }}</span>
      <button (click)="clearError()" class="close-btn" title="Fermer">×</button>
    </div>
    <button (click)="refreshStats()" class="retry-btn">Réessayer</button>
  </div>
  
  <!-- Message quand aucun projet -->
  <div *ngIf="!isLoading && !hasProjects && !errorMessage" class="no-projects">
    <div class="no-projects-content">
      <i class="fas fa-folder-open"></i>
      <h3>Aucun projet trouvé</h3>
      <p>Commencez par créer votre premier projet pour lancer vos campagnes de financement.</p>
      <button (click)="createNewProject()" class="create-btn">
        <i class="fas fa-plus"></i>
        Créer un nouveau projet
      </button>
    </div>
  </div>

  <!-- Grille des projets réels -->
  <div class="projects-grid" *ngIf="!isLoading && hasProjects">
    <div class="project-card" *ngFor="let project of projects">
      <div class="card-header">
        <span class="amount">{{ project.funds }}</span>
        <span class="category-badge" [class]="project.sector.toLowerCase()">{{ project.sector }}</span>
      </div>
      <div class="card-content">
        <div class="media-section">
          <ng-container *ngIf="project.hasMedia; else mediaPlaceholder">
            <div class="media-grid" [ngClass]="{'has-side': project.images.length > 1 || project.videoUrl}">
              <div class="media-main" *ngIf="project.images.length">
                <div class="image-carousel">
                  <img [src]="getCurrentImage(project)" [alt]="'Image du projet ' + project.title" loading="lazy" class="carousel-image">
                  <button class="carousel-btn carousel-btn-prev" *ngIf="project.images.length > 1" (click)="prevImage(project)">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                  <button class="carousel-btn carousel-btn-next" *ngIf="project.images.length > 1" (click)="nextImage(project)">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                  <div class="carousel-indicators" *ngIf="project.images.length > 1">
                    <span *ngFor="let image of project.images; let i = index" 
                          class="indicator" 
                          [class.active]="(currentImageIndex[project.id] || 0) === i"
                          (click)="goToImage(project, i)">
                    </span>
                  </div>
                </div>
              </div>
              <div class="media-side" *ngIf="project.images.length > 1 || project.videoUrl">
                <div class="media-thumbnails" *ngIf="project.images.length > 1">
                  <div class="thumbnail" *ngFor="let image of project.images.slice(1,4); let i = index">
                    <img [src]="image" [alt]="'Image du projet ' + project.title" loading="lazy">
                  </div>
                </div>
                <div class="media-video" *ngIf="project.videoUrl">
                  <video controls preload="metadata" [attr.poster]="project.images[0] || null">
                    <source [src]="project.videoUrl" type="video/mp4">
                    Votre navigateur ne supporte pas la lecture vidéo.
                  </video>
                  <span class="video-label"><i class="fas fa-play"></i> Pitch vidéo</span>
                </div>
              </div>
            </div>
          </ng-container>
          <ng-template #mediaPlaceholder>
            <div class="media-placeholder">
              <i class="fas fa-photo-video"></i>
              <span>Ajoutez des visuels pour sublimer votre projet</span>
            </div>
          </ng-template>
        </div>
        <div class="collaborators">
          <i class="fas fa-users"></i>
          <span>{{ project.collaborators }}</span>
        </div>
        <h3>{{ project.title }}</h3>
        <p>{{ project.description }}</p>
        <div class="card-footer">
          <span class="date">Fin: {{ project.endDate }}</span>
          <span class="status-badge" [ngClass]="project.statusDetail.toLowerCase()">{{ project.status }}</span>
        </div>
      </div>
    </div>
  </div>
</section>
